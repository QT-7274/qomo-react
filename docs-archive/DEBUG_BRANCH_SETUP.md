# 调试分支设置指南

## 🎯 **方案说明**

创建一个专门的调试分支，在云端部署后可以访问调试页面，解决本地无法测试真实云端功能的问题。

## 🔧 **Git 分支操作**

### 1. 创建调试分支

```bash
# 确保在主分支上
git checkout main

# 创建并切换到调试分支
git checkout -b debug/cloud-testing

# 推送到远程仓库
git push -u origin debug/cloud-testing
```

### 2. 验证当前修改

当前已经添加的调试功能：

- ✅ 新增调试路由：`/debug/cloud-sync` 和 `/debug/kv-test`
- ✅ 调试导航组件：自动显示在调试路由中
- ✅ 云端同步管理页面：完整的模板 CRUD 功能
- ✅ KV 存储测试页面：EdgeOne Pages 功能测试
- ✅ 移除开发工具中的调试按钮：避免主分支用户困惑

### 3. 部署到云端

将调试分支部署到 EdgeOne Pages：

1. **在 EdgeOne Pages 控制台**：
   - 选择部署分支为 `debug/cloud-testing`
   - 或创建新的部署环境专门用于调试分支

2. **访问调试页面**：
   ```
   https://your-domain.com/debug/cloud-sync    # 云端同步管理
   https://your-domain.com/debug/kv-test       # KV 存储测试
   ```

## 🎨 **调试页面功能**

### `/debug/cloud-sync` - 云端同步管理

**功能特性**：
- 📊 **状态面板**：显示本地、云端、公开模板数量
- 🔄 **模式切换**：本地模式 vs 云端模式
- 📋 **四个标签页**：本地模板、云端模板、公开模板、调试信息
- ⚡ **快速操作**：创建测试模板、批量上传、下载同步

**主要操作**：
- ➕ **创建测试模板**：快速生成测试数据
- ⬆️ **保存到云端**：将本地模板上传到 KV 存储
- ⬇️ **从云端获取**：下载云端模板到本地
- 🗃️ **公开模板**：浏览和使用公开分享的模板
- 🔍 **调试信息**：查看 EdgeOne Pages 环境状态

### `/debug/kv-test` - KV 存储测试

**功能特性**：
- 🧪 **基础功能测试**：KV 增删改查、访问计数器
- 🔍 **环境调试**：检查 KV 配置和环境变量
- 🗝️ **键列表查看**：查看所有存储的键名
- 📝 **模板功能测试**：保存和获取模板

## 🚀 **使用流程**

### 开发阶段（本地）

1. **在调试分支开发**：
   ```bash
   git checkout debug/cloud-testing
   npm run dev
   ```

2. **本地测试**：
   - 访问 `http://localhost:5175/debug/cloud-sync`
   - 使用本地模式进行功能开发
   - 避免网络请求错误

### 测试阶段（云端）

1. **部署调试分支**：
   - 将 `debug/cloud-testing` 分支部署到 EdgeOne Pages
   - 确保 `functions` 文件夹和 KV 配置正确

2. **云端测试**：
   - 访问 `https://your-domain.com/debug/cloud-sync`
   - 切换到云端模式测试真实功能
   - 使用调试信息排查问题

### 生产阶段（主分支）

1. **功能验证完成后**：
   ```bash
   # 切换回主分支
   git checkout main
   
   # 合并需要的功能（不包括调试路由）
   git cherry-pick <specific-commits>
   ```

2. **主分支部署**：
   - 主分支不包含调试路由
   - 用户无法访问调试页面
   - 保持生产环境的简洁性

## 📋 **调试检查清单**

### 部署前检查

- [ ] KV 命名空间已创建
- [ ] 环境变量 `qomo` 已配置
- [ ] `functions` 文件夹已上传
- [ ] 调试分支已推送到远程

### 功能测试检查

- [ ] 访问 `/debug/cloud-sync` 页面正常
- [ ] 调试导航显示正确
- [ ] 创建测试模板功能正常
- [ ] 云端模式下可以保存/获取模板
- [ ] 调试信息显示环境状态
- [ ] KV 存储测试页面功能正常

### 错误排查

如果遇到问题：

1. **检查调试信息**：访问调试信息标签页
2. **查看网络请求**：浏览器开发者工具 Network 标签
3. **检查 KV 配置**：确认命名空间绑定正确
4. **验证函数部署**：确认 functions 文件夹已上传

## 🔄 **分支管理策略**

```
main (生产分支)
├── 不包含调试路由
├── 用户无法访问调试页面
└── 保持代码简洁

debug/cloud-testing (调试分支)
├── 包含完整调试功能
├── 可以在云端访问调试页面
└── 用于开发和测试云端功能
```

## 🎉 **优势总结**

1. **本地开发**：使用本地模式，避免网络错误
2. **云端测试**：部署调试分支，测试真实功能
3. **生产隔离**：主分支不包含调试代码
4. **完整功能**：提供完整的模板管理和测试工具
5. **问题排查**：详细的调试信息和错误处理

这样你就可以在调试分支中完整地测试云端功能，同时保持主分支的简洁性！🚀
